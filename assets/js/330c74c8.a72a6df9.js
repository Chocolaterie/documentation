"use strict";(self.webpackChunkschool_learn=self.webpackChunkschool_learn||[]).push([[4448],{3280:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>d,metadata:()=>l,toc:()=>c});var i=n(7624),t=n(2172);const d={sidebar_position:5},r="Les ids",l={id:"nodejs/course/id",title:"Les ids",description:"Pourquoi \xe9viter d'utiliser des IDs entiers pour des donn\xe9es nombreuses ?",source:"@site/docs/nodejs/course/id.md",sourceDirName:"nodejs/course",slug:"/nodejs/course/id",permalink:"/documentation/docs/nodejs/course/id",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/nodejs/course/id.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Logger (winston)",permalink:"/documentation/docs/nodejs/course/logger"},next:{title:"TP",permalink:"/documentation/docs/category/tp-3"}},o={},c=[{value:"Pourquoi \xe9viter d&#39;utiliser des IDs entiers pour des donn\xe9es nombreuses ?",id:"pourquoi-\xe9viter-dutiliser-des-ids-entiers-pour-des-donn\xe9es-nombreuses-",level:2},{value:"Probl\xe8mes avec les IDs entiers (<code>INT</code>, <code>BIGINT</code>)",id:"probl\xe8mes-avec-les-ids-entiers-int-bigint",level:3},{value:"1. <strong>Capacit\xe9 limit\xe9e</strong>",id:"1-capacit\xe9-limit\xe9e",level:4},{value:"2. <strong>Conflits et contention en base</strong>",id:"2-conflits-et-contention-en-base",level:4},{value:"3. <strong>Pas d\u2019unicit\xe9 globale</strong>",id:"3-pas-dunicit\xe9-globale",level:4},{value:"4. <strong>Pr\xe9visibilit\xe9 = Risques de s\xe9curit\xe9</strong>",id:"4-pr\xe9visibilit\xe9--risques-de-s\xe9curit\xe9",level:4},{value:"5. <strong>Fusion de donn\xe9es difficile</strong>",id:"5-fusion-de-donn\xe9es-difficile",level:4},{value:"Alternatives recommand\xe9es",id:"alternatives-recommand\xe9es",level:3},{value:"En r\xe9sum\xe9 :",id:"en-r\xe9sum\xe9-",level:3},{value:"Pourquoi ne faut-il pas exposer les <code>_id</code> MongoDB dans les URLs ?",id:"pourquoi-ne-faut-il-pas-exposer-les-_id-mongodb-dans-les-urls-",level:2},{value:"1. Pr\xe9visibilit\xe9 et \xe9num\xe9ration",id:"1-pr\xe9visibilit\xe9-et-\xe9num\xe9ration",level:3},{value:"2. Fuite d\u2019informations internes",id:"2-fuite-dinformations-internes",level:3},{value:"3. Couplage \xe0 l\u2019impl\xe9mentation de la base de donn\xe9es",id:"3-couplage-\xe0-limpl\xe9mentation-de-la-base-de-donn\xe9es",level:3},{value:"4. Complexit\xe9 accrue de la gestion des autorisations",id:"4-complexit\xe9-accrue-de-la-gestion-des-autorisations",level:3},{value:"Recommandations",id:"recommandations",level:3},{value:"Exemple",id:"exemple",level:3}];function a(e){const s={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"les-ids",children:"Les ids"}),"\n",(0,i.jsx)(s.h2,{id:"pourquoi-\xe9viter-dutiliser-des-ids-entiers-pour-des-donn\xe9es-nombreuses-",children:"Pourquoi \xe9viter d'utiliser des IDs entiers pour des donn\xe9es nombreuses ?"}),"\n",(0,i.jsx)(s.p,{children:"Lorsque vous concevez des bases de donn\xe9es susceptibles de contenir des millions (voire des milliards) de lignes, il faut faire attention au type d'identifiants utilis\xe9s."}),"\n",(0,i.jsxs)(s.h3,{id:"probl\xe8mes-avec-les-ids-entiers-int-bigint",children:["Probl\xe8mes avec les IDs entiers (",(0,i.jsx)(s.code,{children:"INT"}),", ",(0,i.jsx)(s.code,{children:"BIGINT"}),")"]}),"\n",(0,i.jsxs)(s.h4,{id:"1-capacit\xe9-limit\xe9e",children:["1. ",(0,i.jsx)(s.strong,{children:"Capacit\xe9 limit\xe9e"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"INT"})," (4 octets) : maximum ",(0,i.jsx)(s.strong,{children:"2 147 483 647"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"BIGINT"})," (8 octets) : environ ",(0,i.jsx)(s.strong,{children:"9 quintillions"}),", mais reste une ",(0,i.jsx)(s.strong,{children:"ressource finie"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Avec des volumes tr\xe8s \xe9lev\xe9s, ",(0,i.jsx)(s.strong,{children:"le d\xe9passement est possible"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.h4,{id:"2-conflits-et-contention-en-base",children:["2. ",(0,i.jsx)(s.strong,{children:"Conflits et contention en base"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Les ",(0,i.jsx)(s.code,{children:"AUTO_INCREMENT"})," peuvent causer des ",(0,i.jsx)(s.strong,{children:"goulots d'\xe9tranglement"})," lors d'\xe9critures concurrentes."]}),"\n",(0,i.jsxs)(s.li,{children:["Risques accrus dans des bases ",(0,i.jsx)(s.strong,{children:"fortement sollicit\xe9es"})," ou ",(0,i.jsx)(s.strong,{children:"distribu\xe9es"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.h4,{id:"3-pas-dunicit\xe9-globale",children:["3. ",(0,i.jsx)(s.strong,{children:"Pas d\u2019unicit\xe9 globale"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Les IDs auto-incr\xe9ment\xe9s sont uniques ",(0,i.jsx)(s.strong,{children:"dans une base"}),", mais pas \xe0 l\u2019\xe9chelle de plusieurs serveurs ou applications."]}),"\n",(0,i.jsxs)(s.li,{children:["Difficile \xe0 g\xe9rer dans un ",(0,i.jsx)(s.strong,{children:"syst\xe8me distribu\xe9"})," ou avec ",(0,i.jsx)(s.strong,{children:"des imports de donn\xe9es externes"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.h4,{id:"4-pr\xe9visibilit\xe9--risques-de-s\xe9curit\xe9",children:["4. ",(0,i.jsx)(s.strong,{children:"Pr\xe9visibilit\xe9 = Risques de s\xe9curit\xe9"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Les IDs s\xe9quentiels sont faciles \xe0 deviner (",(0,i.jsx)(s.code,{children:"/user/1"}),", ",(0,i.jsx)(s.code,{children:"/user/2"}),", etc.)."]}),"\n",(0,i.jsxs)(s.li,{children:["Cela peut ",(0,i.jsx)(s.strong,{children:"exposer des donn\xe9es"})," sensibles si les contr\xf4les d\u2019acc\xe8s sont mal faits."]}),"\n"]}),"\n",(0,i.jsxs)(s.h4,{id:"5-fusion-de-donn\xe9es-difficile",children:["5. ",(0,i.jsx)(s.strong,{children:"Fusion de donn\xe9es difficile"})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Deux tables issues de bases diff\xe9rentes peuvent avoir des IDs identiques (",(0,i.jsx)(s.code,{children:"user_id = 42"}),"), ce qui complique les ",(0,i.jsx)(s.strong,{children:"imports ou fusions de donn\xe9es"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"alternatives-recommand\xe9es",children:"Alternatives recommand\xe9es"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Type d'ID"}),(0,i.jsx)(s.th,{children:"Avantages cl\xe9s"}),(0,i.jsx)(s.th,{children:"Inconv\xe9nients"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"UUID"})," (v4)"]}),(0,i.jsx)(s.td,{children:"Unique globalement, non s\xe9quentiel"}),(0,i.jsx)(s.td,{children:"Taille (16 octets), non tri\xe9"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"UUIDv7"})," / ",(0,i.jsx)(s.code,{children:"ULID"})]}),(0,i.jsx)(s.td,{children:"Unique, encod\xe9 avec un timestamp, triable"}),(0,i.jsxs)(s.td,{children:["Taille plus grande que ",(0,i.jsx)(s.code,{children:"INT"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Snowflake"})}),(0,i.jsx)(s.td,{children:"Unique, timestamp + shard ID + incr\xe9ment"}),(0,i.jsx)(s.td,{children:"Impl\xe9mentation + stockage"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"en-r\xe9sum\xe9-",children:"En r\xe9sum\xe9 :"}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["Pour des donn\xe9es ",(0,i.jsx)(s.strong,{children:"nombreuses, sensibles ou distribu\xe9es"}),", \xe9vitez les IDs ",(0,i.jsx)(s.code,{children:"INT"})," auto-incr\xe9ment\xe9s. Pr\xe9f\xe9rez des identifiants ",(0,i.jsx)(s.strong,{children:"globalement uniques"}),", comme ",(0,i.jsx)(s.code,{children:"UUID"}),", ",(0,i.jsx)(s.code,{children:"ULID"}),", ou des solutions de type ",(0,i.jsx)(s.code,{children:"Snowflake"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.admonition,{title:"Tip",type:"info",children:(0,i.jsxs)(s.p,{children:["Pour les petits projets ou des donn\xe9es peu critiques, un ",(0,i.jsx)(s.code,{children:"INT AUTO_INCREMENT"})," reste simple et performant."]})}),"\n",(0,i.jsxs)(s.h2,{id:"pourquoi-ne-faut-il-pas-exposer-les-_id-mongodb-dans-les-urls-",children:["Pourquoi ne faut-il pas exposer les ",(0,i.jsx)(s.code,{children:"_id"})," MongoDB dans les URLs ?"]}),"\n",(0,i.jsxs)(s.p,{children:["Exposer les identifiants MongoDB (",(0,i.jsx)(s.code,{children:"_id"}),") dans les URLs peut sembler pratique, mais cela pr\xe9sente plusieurs inconv\xe9nients importants, surtout en termes de s\xe9curit\xe9, de maintenabilit\xe9 et de bonnes pratiques."]}),"\n",(0,i.jsx)(s.h3,{id:"1-pr\xe9visibilit\xe9-et-\xe9num\xe9ration",children:"1. Pr\xe9visibilit\xe9 et \xe9num\xe9ration"}),"\n",(0,i.jsxs)(s.p,{children:["Les ",(0,i.jsx)(s.code,{children:"_id"})," de MongoDB sont de type ",(0,i.jsx)(s.code,{children:"ObjectId"}),", un format qui contient :"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Un ",(0,i.jsx)(s.strong,{children:"timestamp"})," (date de cr\xe9ation),"]}),"\n",(0,i.jsx)(s.li,{children:"Un identifiant machine,"}),"\n",(0,i.jsx)(s.li,{children:"Un PID (process ID),"}),"\n",(0,i.jsx)(s.li,{children:"Un compteur."}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Cela les rend ",(0,i.jsx)(s.strong,{children:"semi-pr\xe9visibles"}),". Un attaquant qui conna\xeet un ",(0,i.jsx)(s.code,{children:"_id"})," peut essayer de deviner ou g\xe9n\xe9rer d'autres identifiants proches. C\u2019est ce qu\u2019on appelle une ",(0,i.jsx)(s.strong,{children:"attaque par \xe9num\xe9ration d\u2019identifiants"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"2-fuite-dinformations-internes",children:"2. Fuite d\u2019informations internes"}),"\n",(0,i.jsxs)(s.p,{children:["Le ",(0,i.jsx)(s.code,{children:"ObjectId"})," encode la ",(0,i.jsx)(s.strong,{children:"date exacte de cr\xe9ation"})," d\u2019un document. Cela peut :"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"R\xe9v\xe9ler des informations sur le volume et la fr\xe9quence des op\xe9rations,"}),"\n",(0,i.jsx)(s.li,{children:"Donner des indices \xe0 un attaquant sur les p\xe9riodes d\u2019activit\xe9."}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["M\xeame si cela semble anodin, ",(0,i.jsx)(s.strong,{children:"toute fuite d\u2019information est \xe0 \xe9viter"})," par principe de pr\xe9caution."]}),"\n",(0,i.jsx)(s.h3,{id:"3-couplage-\xe0-limpl\xe9mentation-de-la-base-de-donn\xe9es",children:"3. Couplage \xe0 l\u2019impl\xe9mentation de la base de donn\xe9es"}),"\n",(0,i.jsxs)(s.p,{children:["En exposant les ",(0,i.jsx)(s.code,{children:"_id"}),", on rend l\u2019API d\xe9pendante de la structure interne de la base. Cela pose plusieurs probl\xe8mes :"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Difficult\xe9 \xe0 changer de base ou de strat\xe9gie d\u2019identifiants,"}),"\n",(0,i.jsx)(s.li,{children:"URLs non parlantes et peu lisibles,"}),"\n",(0,i.jsx)(s.li,{children:"Manque de flexibilit\xe9 si on souhaite modifier l\u2019architecture plus tard."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"4-complexit\xe9-accrue-de-la-gestion-des-autorisations",children:"4. Complexit\xe9 accrue de la gestion des autorisations"}),"\n",(0,i.jsxs)(s.p,{children:["Si l\u2019URL contient un ",(0,i.jsx)(s.code,{children:"_id"}),", il faut syst\xe9matiquement v\xe9rifier que l\u2019utilisateur a le droit d\u2019y acc\xe9der. Cela rend les contr\xf4les d\u2019acc\xe8s plus complexes et plus sujets \xe0 oubli."]}),"\n",(0,i.jsx)(s.p,{children:"Avec des identifiants m\xe9tiers ou des tokens g\xe9n\xe9r\xe9s c\xf4t\xe9 application, on peut encapsuler plus facilement des r\xe8gles de s\xe9curit\xe9."}),"\n",(0,i.jsx)(s.h3,{id:"recommandations",children:"Recommandations"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ne pas utiliser directement les ",(0,i.jsx)(s.code,{children:"_id"})," dans les routes d\u2019API publiques."]}),"\n",(0,i.jsxs)(s.li,{children:["Utiliser \xe0 la place :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["des ",(0,i.jsx)(s.strong,{children:"UUID g\xe9n\xe9r\xe9s c\xf4t\xe9 application"}),","]}),"\n",(0,i.jsxs)(s.li,{children:["des ",(0,i.jsx)(s.strong,{children:"slugs lisibles et uniques"})," (ex: ",(0,i.jsx)(s.code,{children:"/articles/mon-titre"}),"),"]}),"\n",(0,i.jsxs)(s.li,{children:["ou des ",(0,i.jsx)(s.strong,{children:"identifiants abstraits ou opaques"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"exemple",children:"Exemple"}),"\n",(0,i.jsx)(s.p,{children:"Mauvaise pratique :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"GET /api/users/64ae2fddc9a6f43b6a9b7a2e\n"})}),"\n",(0,i.jsx)(s.p,{children:"Bonne pratique :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"GET /api/users/benoit-dupont\nGET /api/users/00f5e390-b821-46fc-a3f2-b3f5a19dd9cf\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.admonition,{title:"Tip",type:"info",children:(0,i.jsx)(s.p,{children:"Un bon identifiant dans une URL est stable, non pr\xe9visible, et d\xe9coupl\xe9 de l\u2019impl\xe9mentation technique interne."})})]})}function u(e={}){const{wrapper:s}={...(0,t.M)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},2172:(e,s,n)=>{n.d(s,{I:()=>l,M:()=>r});var i=n(1504);const t={},d=i.createContext(t);function r(e){const s=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(d.Provider,{value:s},e.children)}}}]);