"use strict";(self.webpackChunkschool_learn=self.webpackChunkschool_learn||[]).push([[3212],{9988:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var r=t(7624),i=t(2172);const s={sidebar_position:1},a="JWT",o={id:"spring-security/course/jwt-01",title:"JWT",description:"D\xe9pendances",source:"@site/docs/spring-security/course/jwt-01.md",sourceDirName:"spring-security/course",slug:"/spring-security/course/jwt-01",permalink:"/documentation/docs/spring-security/course/jwt-01",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/spring-security/course/jwt-01.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"TP Eni Store API (Partie 7 - JWT)",permalink:"/documentation/docs/spring-security/tp/v2/tp-7-jwt"},next:{title:"JWT",permalink:"/documentation/docs/spring-security/course/jwt-filter"}},c={},l=[{value:"D\xe9pendances",id:"d\xe9pendances",level:2},{value:"G\xe9n\xe9rer un token",id:"g\xe9n\xe9rer-un-token",level:2},{value:"Tester un token",id:"tester-un-token",level:2},{value:"Externaliser l&#39;acc\xe8s \xe0 la cl\xe9 secr\xe8te",id:"externaliser-lacc\xe8s-\xe0-la-cl\xe9-secr\xe8te",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,i.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"jwt",children:"JWT"}),"\n",(0,r.jsx)(n.h2,{id:"d\xe9pendances",children:"D\xe9pendances"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"// Jwt\nimplementation 'io.jsonwebtoken:jjwt-api:0.12.6'\nruntimeOnly 'io.jsonwebtoken:jjwt-impl:0.12.6'\nruntimeOnly 'io.jsonwebtoken:jjwt-jackson:0.12.6'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"g\xe9n\xe9rer-un-token",children:"G\xe9n\xe9rer un token"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// Pour genere un token\n// -- la date ou ca \xe9t\xe9 cr\xe9e (IssueAt)\n// -- une date d'expiration (Expiration)\n// -- une donn\xe9e subjectif (Subject)\n// -- l'algo pour crypter (HS256)\n// -- la cl\xe9 secr\xeate\n\n// -- temps de vie du token\nDate tokenLifetime = new Date(System.currentTimeMillis() + 1000 * 60 * 24);\n\n// Le code qui genere le token\nString token = Jwts.builder()\n    .setSubject(\"quelquun@gmail.com\")\n    .issuedAt(new Date(System.currentTimeMillis()))\n    .setExpiration(tokenLifetime)\n    .signWith(getKey(), SignatureAlgorithm.HS256)\n    .compact();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tester-un-token",children:"Tester un token"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// R\xe9cup\xe9rer le token dans le header authorization\n// On substring 7 caract\xe8res car le header contient "Bearer tontoken"\nString token = authorization.substring(7);\n\ntry {\n   // Outil pour r\xe9cup\xe9rer le token (d\xe9chiffrer)\n    JwtParser jwtParser = Jwts.parser().setSigningKey(key).build();\n\n    // -- r\xe9cup\xe9rer les claims de mon token (claims => toutes les info)\n    Claims claims = jwtParser.parseSignedClaims(token).getBody();\n    \n    // R\xe9cup\xe9rer la date\n    // 1: Version abstraite\n    // Function<Claims, Date> expirationFunction = Claims::getExpiration;\n    // Date expirationDate = expirationFunction.apply(claims);\n    // 2: Version explicite\n    Date expirationDate = claims.getExpiration();\n    \n } catch (Exception e) {\n    // Si la date d\'expiration est depass\xe9 alors\n    // Si exception jwt de type expiration\n    if (e instanceof ExpiredJwtException){\n        return "Token expir\xe9";\n    }\n\n    // Si token malform\xe9\n    if (e instanceof MalformedJwtException){\n        return "Token malform\xe9";\n    }\n\n    return "Erreur inconnue";\n}\n\nreturn "Token valide";\n'})}),"\n",(0,r.jsx)(n.h2,{id:"externaliser-lacc\xe8s-\xe0-la-cl\xe9-secr\xe8te",children:"Externaliser l'acc\xe8s \xe0 la cl\xe9 secr\xe8te"}),"\n",(0,r.jsx)(n.p,{children:"Voici un exemple pour d\xe9porter l'acc\xe8s \xe0 la cl\xe9 secr\xe8te avec la valeur de la cl\xe9 stocker dans un fichier config"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * R\xe9cup\xe9rer la valeur de app.jwt.secret dans application.properties\n */\n@Value("${app.jwt.secret}")\nprivate String SECRET_KEY;\n\nprivate Key getSecretKey() {\n    // convertir un string en base 64\n    byte[] keyBytes = Decoders.BASE64.decode(SECRET_KEY);\n    // convertir une base 64 en Key\n    Key key = Keys.hmacShaKeyFor(keyBytes);\n\n    return key;\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Evidement cela veut dire que dans votre application.properties (dans notre cas en tout cas) vous avez bien :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"app.jwt.secret=69636e783529213d5722613b2b336c793371666524684a3445226e5573\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},2172:(e,n,t)=>{t.d(n,{I:()=>o,M:()=>a});var r=t(1504);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);