"use strict";(self.webpackChunkschool_learn=self.webpackChunkschool_learn||[]).push([[584],{476:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>d});var a=s(7624),o=s(2172);const t={sidebar_position:10},i="Room",r={id:"android/course/compose/m-demoroom",title:"Room",description:"D\xe9pendances",source:"@site/docs/android/course/compose/m-demoroom.md",sourceDirName:"android/course/compose",slug:"/android/course/compose/m-demoroom",permalink:"/documentation/docs/android/course/compose/m-demoroom",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/android/course/compose/m-demoroom.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"ListView et RecyclerView",permalink:"/documentation/docs/android/course/compose/m08-listview"},next:{title:"Associer des champs",permalink:"/documentation/docs/android/course/compose/m08-data-binding-class"}},l={},d=[{value:"D\xe9pendances",id:"d\xe9pendances",level:2},{value:"Entity",id:"entity",level:2},{value:"DAO",id:"dao",level:2},{value:"Exemple d&#39;un AppDatabase",id:"exemple-dun-appdatabase",level:2},{value:"Appel T\xe2che Asynchrone",id:"appel-t\xe2che-asynchrone",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,o.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"room",children:"Room"}),"\n",(0,a.jsx)(n.h2,{id:"d\xe9pendances",children:"D\xe9pendances"}),"\n",(0,a.jsx)(n.p,{children:"Dans le build.gradle section plugins :"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:'id("com.google.devtools.ksp") version "1.9.20-1.0.14"'})}),"\n",(0,a.jsx)(n.p,{children:"Exemple:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'plugins {\n    alias(libs.plugins.android.application)\n    alias(libs.plugins.kotlin.android)\n    id("com.google.devtools.ksp") version "1.9.20-1.0.14"\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Et ces 3 d\xe9pendances :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'// ROOM\nimplementation("androidx.room:room-runtime:2.6.0")\nksp("androidx.room:room-compiler:2.6.0")\nimplementation("androidx.room:room-ktx:2.6.0")\n'})}),"\n",(0,a.jsx)(n.admonition,{title:"Attention",type:"warning",children:(0,a.jsxs)(n.p,{children:["Le ",(0,a.jsx)(n.strong,{children:"ksp"})," c'est un utilitaire qui vient de ",(0,a.jsx)(n.code,{children:'id("com.google.devtools.ksp") version "1.9.20-1.0.14"'})," qu'on a mis en haut. il faut faire un ",(0,a.jsx)(n.strong,{children:"SyncNow"})," pour qu'il l'installe"]})}),"\n",(0,a.jsx)(n.h2,{id:"entity",children:"Entity"}),"\n",(0,a.jsx)(n.p,{children:"Exemple d\xe9claration d'une entit\xe9"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:'@Entity\ndata class Flan(\n    @PrimaryKey(autoGenerate = true) var id : Long = 0,\n    var name : String = "",\n    var klg : Float = 424.24f) {\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"dao",children:"DAO"}),"\n",(0,a.jsx)(n.p,{children:"Exemple de DAO. Attention c'est une interface !"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:'@Dao\ninterface FlanDAO {\n\n    @Insert\n    suspend fun insertFlan(flan: Flan)\n\n    @Query("SELECT * FROM Flan")\n    fun selectAll() : List<Flan>\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Attention ne pas oubli\xe9 d\"inject la DAO et l'entit\xe9 dans AppDatabase :"}),"\n",(0,a.jsx)(n.p,{children:"Entity Inject\xe9e:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:"@Database(entities = [Flan::class], version = 1)\n"})}),"\n",(0,a.jsx)(n.p,{children:"DAO Inject\xe9e:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:" abstract fun flanDAO() : FlanDAO\n"})}),"\n",(0,a.jsx)(n.h2,{id:"exemple-dun-appdatabase",children:"Exemple d'un AppDatabase"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:'@Database(entities = [Flan::class], version = 1)\nabstract class AppDatabase : RoomDatabase() {\n\n    abstract fun flanDAO() : FlanDAO\n\n    companion object {\n\n        var INSTANCE: AppDatabase? = null;\n\n        fun getInstance(context: Context): AppDatabase {\n            if (INSTANCE == null) {\n\n                INSTANCE = Room.databaseBuilder(context, AppDatabase::class.java, "MyBdd.db")\n                    .fallbackToDestructiveMigration().build()\n            }\n            return INSTANCE!!\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"appel-t\xe2che-asynchrone",children:"Appel T\xe2che Asynchrone"}),"\n",(0,a.jsxs)(n.p,{children:["Toutes les requ\xeates doivent \xeatre ex\xe9cut\xe9es sur un thread en dehors du thread principal (UI thread), elles doivent donc \xeatre appel\xe9es dans une ",(0,a.jsx)(n.strong,{children:"Coroutine"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["En g\xe9n\xe9ral, les fonctions du ",(0,a.jsx)(n.strong,{children:"DAO"})," doivent \xeatre d\xe9finies avec le mot-cl\xe9 ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"suspend"})})," pour indiquer qu'elles sont des fonctions suspendues et qu'elles peuvent \xeatre appel\xe9es de mani\xe8re asynchrone dans une coroutine."]}),"\n",(0,a.jsx)(n.p,{children:"Exemple d'utilisation avec un MutableStateFlow :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kt",children:"// R\xe9cup\xe9rer la DAO via la AppDatabase\nval flanDAO = AppDatabase.getInstance(this).flanDAO();\n\n// Mettre \xe0 jour la liste de flan \xe9coutable DANS UNE COROUTINE\nlifecycleScope.launch {\n    flans.value = flanDAO.selectAll()\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>r,M:()=>i});var a=s(1504);const o={},t=a.createContext(o);function i(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);